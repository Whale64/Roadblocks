<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HTML Kart Racer</title>
<style>
body { margin:0; overflow:hidden; background:#222; }
canvas { display:block; margin:auto; background:#4CAF50; }
#ui {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-family:Arial;
  font-size:18px;
}
</style>
</head>
<body>

<div id="ui"></div>
<canvas id="gameCanvas" width="1000" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

const TRACK = { x:200, y:100, w:600, h:400 };
const INNER = { x:350, y:200, w:300, h:200 };

class Kart {
  constructor(x,y,color,isAI=false){
    this.x=x; this.y=y;
    this.color=color;
    this.angle=0;
    this.speed=0;
    this.maxSpeed=5;
    this.acc=0.2;
    this.turnSpeed=0.05;
    this.friction=0.04;
    this.lap=0;
    this.hasRocket=false;
    this.isAI=isAI;
    this.driftCharge=0;
    this.crossedLine=false;
  }

  update(){
    if(!this.isAI){
      if(keys["ArrowUp"]) this.speed+=this.acc;
      if(keys["ArrowDown"]) this.speed-=this.acc;

      if(keys["ArrowLeft"]) this.angle-=this.turnSpeed;
      if(keys["ArrowRight"]) this.angle+=this.turnSpeed;

      if(keys["Shift"]) this.driftCharge++;
      if(!keys["Shift"] && this.driftCharge>25){
        this.speed+=3;
        this.driftCharge=0;
      }

      if(keys[" "] && this.hasRocket){
        rockets.push(new Rocket(this));
        this.hasRocket=false;
      }
    } else {
      this.angle+=0.01;
      this.speed=3;
    }

    this.speed*= (1-this.friction);
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed;

    this.checkTrack();
  }

  checkTrack(){
    if(this.x<TRACK.x||this.x>TRACK.x+TRACK.w||
       this.y<TRACK.y||this.y>TRACK.y+TRACK.h||
       (this.x>INNER.x&&this.x<INNER.x+INNER.w&&
        this.y>INNER.y&&this.y<INNER.y+INNER.h)){
        this.speed*=0.8;
    }

    // Lap detection
    if(this.y<TRACK.y+5 && this.x>300 && this.x<700){
      if(!this.crossedLine){
        this.lap++;
        this.crossedLine=true;
      }
    } else {
      this.crossedLine=false;
    }
  }

  draw(){
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.rotate(this.angle);
    ctx.fillStyle=this.color;
    ctx.fillRect(-15,-10,30,20);
    ctx.restore();
  }
}

class Rocket{
  constructor(owner){
    this.x=owner.x;
    this.y=owner.y;
    this.angle=owner.angle;
    this.speed=8;
  }

  update(){
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed;
  }

  draw(){
    ctx.fillStyle="yellow";
    ctx.fillRect(this.x-5,this.y-5,10,10);
  }
}

class ItemBox{
  constructor(x,y){
    this.x=x; this.y=y;
  }

  draw(){
    ctx.fillStyle="blue";
    ctx.fillRect(this.x-10,this.y-10,20,20);
  }

  checkCollision(player){
    let dx=player.x-this.x;
    let dy=player.y-this.y;
    if(Math.sqrt(dx*dx+dy*dy)<20){
      player.hasRocket=true;
    }
  }
}

const player=new Kart(500,480,"red");
const ai1=new Kart(520,480,"blue",true);
const ai2=new Kart(480,480,"purple",true);
const rockets=[];
const itemBoxes=[new ItemBox(500,150)];

function drawTrack(){
  ctx.fillStyle="#777";
  ctx.fillRect(TRACK.x,TRACK.y,TRACK.w,TRACK.h);
  ctx.fillStyle="#4CAF50";
  ctx.fillRect(INNER.x,INNER.y,INNER.w,INNER.h);

  ctx.fillStyle="white";
  ctx.fillRect(300,100,400,5);
}

function update(){
  player.update();
  ai1.update();
  ai2.update();

  rockets.forEach(r=>r.update());

  rockets.forEach(r=>{
    [ai1,ai2].forEach(ai=>{
      if(Math.abs(r.x-ai.x)<15&&Math.abs(r.y-ai.y)<15){
        ai.speed=0;
      }
    });
  });

  itemBoxes.forEach(box=>box.checkCollision(player));
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawTrack();
  player.draw();
  ai1.draw();
  ai2.draw();
  rockets.forEach(r=>r.draw());
  itemBoxes.forEach(b=>b.draw());

  ui.innerHTML=
    "Lap: "+player.lap+
    "<br>Rocket: "+(player.hasRocket?"YES":"NO");

  if(player.lap>=3){
    ui.innerHTML+="<br>üèÜ YOU WIN!";
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>